{% extends "base.html" %}

{% block title %}Energy Dashboard{% endblock %}

{% block content %}
<!-- Dashboard Hero -->
<div class="app-hero">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-3">Your Energy Dashboard</h1>
        <p class="fs-5 opacity-75">Real-time analysis of your energy generation and consumption.</p>
    </div>
</div>

<!-- Main Content (Overlapping) -->
<div class="app-container-overlap pb-5">

    <!-- Key Metrics Grid -->
    <div class="row g-4 mb-5">
        <!-- Solar Coverage -->
        <div class="col-md-6 col-lg-3">
            <div class="stat-card" style="--card-border-color: var(--brand-primary);">
                <div class="stat-header">
                    <div class="stat-icon-circle" style="background: #ecfccb; color: var(--brand-secondary);">
                        <i class="fas fa-sun"></i>
                    </div>
                </div>
                <div>
                    <div class="stat-value">{{ data.solar_coverage }}<span class="stat-unit">%</span></div>
                    <div class="stat-label">Solar Coverage</div>
                    <div class="stat-desc mt-3">Needs met by solar</div>
                </div>
            </div>
        </div>

        <!-- CO2 Saved -->
        <div class="col-md-6 col-lg-3">
            <div class="stat-card" style="--card-border-color: #10b981;">
                <div class="stat-header">
                    <div class="stat-icon-circle" style="background: #d1fae5; color: #065f46;">
                        <i class="fas fa-leaf"></i>
                    </div>
                </div>
                <div>
                    <div class="stat-value">{{ data.co2_saved }}<span class="stat-unit">kg</span></div>
                    <div class="stat-label">CO₂ Saved</div>
                    <div class="stat-desc mt-3">~ {{ (data.co2_saved / 20) | round(1) }} trees planted</div>
                </div>
            </div>
        </div>

        <!-- Cost Savings -->
        <div class="col-md-6 col-lg-3">
            <div class="stat-card" style="--card-border-color: #f59e0b;">
                <div class="stat-header">
                    <div class="stat-icon-circle" style="background: #fef3c7; color: #92400e;">
                        <i class="fas fa-wallet"></i>
                    </div>
                </div>
                <div>
                    <div class="stat-value">£{{ data.cost_savings }}</div>
                    <div class="stat-label">Est. Savings</div>
                    <div class="stat-desc mt-3">Based on current rates</div>
                </div>
            </div>
        </div>

        <!-- Self Consumption -->
        <div class="col-md-6 col-lg-3">
            <div class="stat-card" style="--card-border-color: #3b82f6;">
                <div class="stat-header">
                    <div class="stat-icon-circle" style="background: #dbeafe; color: #1e40af;">
                        <i class="fas fa-home"></i>
                    </div>
                </div>
                <div>
                    <div class="stat-value">{{ data.self_consumption }}<span class="stat-unit">%</span></div>
                    <div class="stat-label">Self Consumption</div>
                    <div class="stat-desc mt-3">Direct solar usage</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Analysis Grid -->
    <div class="row g-4 mb-5">

        <!-- Energy Flow -->
        <div class="col-lg-6">
            <div class="analysis-card">
                <div class="analysis-header">
                    <div class="analysis-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <h3 class="analysis-title">Energy Flow</h3>
                </div>
                <div class="analysis-body">
                    <div class="flow-row">
                        <span class="flow-label">Total Generation</span>
                        <span class="flow-value text-success">{{ data.solar_generation_kwh }} kWh</span>
                    </div>
                    <div class="flow-row">
                        <span class="flow-label">Grid Import</span>
                        <span class="flow-value text-danger">{{ data.grid_import_kwh }} kWh</span>
                    </div>
                    <div class="flow-row">
                        <span class="flow-label">Grid Export</span>
                        <span class="flow-value text-primary">{{ data.grid_export_kwh }} kWh</span>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
                        <span class="h6 mb-0 text-secondary">Net Consumption</span>
                        <span class="h4 mb-0 fw-bold">{{ data.total_consumption }} kWh</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- EV Performance -->
        <div class="col-lg-6">
            <div class="analysis-card">
                <div class="analysis-header">
                    <div class="analysis-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <h3 class="analysis-title">EV Performance</h3>
                </div>
                <div class="analysis-body text-center">
                    <div class="mb-4">
                        <div class="display-4 fw-bold text-dark mb-1">{{ data.ev_efficiency }}</div>
                        <span class="text-secondary fw-bold text-uppercase fs-6 ls-1">Efficiency (Wh/km)</span>
                    </div>

                    <div class="p-4 bg-light rounded-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-success fw-bold">EV Energy Share</span>
                            <span class="fw-bold">{{ data.ev_share }}%</span>
                        </div>
                        <div class="ev-bar-bg">
                            <div class="ev-bar-fill" style="width: {{ data.ev_share }}%;"></div>
                        </div>
                        <p class="small text-muted mt-3 mb-0">
                            Your EV accounts for {{ data.ev_share }}% of your total household energy consumption.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action -->
    <div class="text-center pb-4">
        <a href="{{ url_for('energy_use') }}" class="hero-cta-button shadow-lg">
            <i class="fas fa-calculator me-2"></i> New Calculation
        </a>
    </div>

</div>
{% endblock %}