{% extends "base.html" %}

{% block title %}Carbon Footprint Calculator{% endblock %}

{% block content %}
<div class="app-container">
    <div class="card" style="max-width: 800px; margin: 0 auto;">
        <h1>Carbon Footprint Calculator</h1>

        {% if submitted_data %}
        {% if footprint_results %}
        <div style="text-align: center; margin-bottom: 2rem;">
            <div class="card" style="display: inline-block; padding: 2rem 3rem; border: 2px solid var(--accent-green);">
                <h2 style="margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 1rem;">Total Carbon Footprint
                </h2>
                <div style="font-size: 3rem; font-weight: 800; color: var(--primary-green);">
                    {{ footprint_results.total }}
                    <span style="font-size: 1rem; font-weight: 500; color: var(--text-secondary);">kg CO2e / year</span>
                </div>
            </div>
        </div>

        <h3 class="section-title">Breakdown</h3>
        <div class="metrics-row">
            <div class="card metric-card">
                <div class="metric-header">
                    <span class="metric-label">Food</span>
                    <i class="fas fa-utensils metric-icon" style="color: var(--accent-green);"></i>
                </div>
                <div class="metric-value">{{ footprint_results.breakdown.food }} <span
                        style="font-size: 0.5em; color: var(--text-secondary);">kg</span></div>
            </div>
            <div class="card metric-card">
                <div class="metric-header">
                    <span class="metric-label">Travel</span>
                    <i class="fas fa-plane metric-icon" style="color: var(--accent-blue);"></i>
                </div>
                <div class="metric-value">{{ footprint_results.breakdown.travel }} <span
                        style="font-size: 0.5em; color: var(--text-secondary);">kg</span></div>
            </div>
            <div class="card metric-card">
                <div class="metric-header">
                    <span class="metric-label">Home</span>
                    <i class="fas fa-home metric-icon" style="color: var(--accent-purple);"></i>
                </div>
                <div class="metric-value">{{ footprint_results.breakdown.home }} <span
                        style="font-size: 0.5em; color: var(--text-secondary);">kg</span></div>
            </div>
            <div class="card metric-card">
                <div class="metric-header">
                    <span class="metric-label">Stuff</span>
                    <i class="fas fa-shopping-bag metric-icon" style="color: var(--accent-pink);"></i>
                </div>
                <div class="metric-value">{{ footprint_results.breakdown.stuff }} <span
                        style="font-size: 0.5em; color: var(--text-secondary);">kg</span></div>
            </div>
        </div>
        {% endif %}

        <div class="card" style="margin-top: 2rem;">
            <h3 class="section-title" style="margin-bottom: 1rem;">Your Inputs</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                {% for key, value in submitted_data.items() %}
                <div style="background: var(--bg-body); padding: 0.75rem; border-radius: 8px;">
                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">{{
                        key|replace('_', ' ')|title }}</div>
                    <div style="font-weight: 600;">{{ value }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div style="margin-top: 2rem; text-align: center;">
            <a href="{{ url_for('carbon_footprint') }}" class="hero-cta-button">Calculate Again</a>
        </div>
        {% else %}
        <form method="POST" action="">
            {{ form.hidden_tag() }}

            <h2>Food</h2>
            <div class="form-group">
                {{ form.diet.label(class="form-label") }}
                {{ form.diet(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.food_spend.label(class="form-label") }}
                {{ form.food_spend(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.food_waste.label(class="form-label") }}
                {{ form.food_waste(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.local_food.label(class="form-label") }}
                {{ form.local_food(class="form-control") }}
            </div>

            <h2>Travel</h2>
            <div class="form-group">
                {{ form.travel_mode.label(class="form-label") }}
                {{ form.travel_mode(id="travel_mode", class="form-control") }}
            </div>
            <div id="vehicle_type_div" class="form-group">
                {{ form.vehicle_type.label(class="form-label") }}
                {{ form.vehicle_type(class="form-control") }}
            </div>
            <div id="car_hours_div" class="form-group">
                {{ form.car_hours.label(class="form-label") }}
                {{ form.car_hours(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.train_hours.label(class="form-label") }}
                {{ form.train_hours(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.bus_hours.label(class="form-label") }}
                {{ form.bus_hours(class="form-control") }}
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    var travelModeSelect = document.getElementById('travel_mode');
                    var vehicleTypeDiv = document.getElementById('vehicle_type_div');
                    var carHoursDiv = document.getElementById('car_hours_div');

                    function toggleVehicleFields() {
                        var selectedValue = travelModeSelect.value;
                        if (selectedValue.includes('Neither')) {
                            vehicleTypeDiv.style.display = 'none';
                            carHoursDiv.style.display = 'none';
                        } else {
                            vehicleTypeDiv.style.display = 'block';
                            carHoursDiv.style.display = 'block';
                        }
                    }

                    toggleVehicleFields(); // Run on load
                    travelModeSelect.addEventListener('change', toggleVehicleFields); // Run on change
                });
            </script>
            <div class="form-group">
                {{ form.flight_domestic.label(class="form-label") }}
                {{ form.flight_domestic(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.flight_europe.label(class="form-label") }}
                {{ form.flight_europe(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.flight_outside_europe.label(class="form-label") }}
                {{ form.flight_outside_europe(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.flight_offset.label(class="form-label") }}
                {{ form.flight_offset(class="form-control") }}
            </div>

            <h2>Home</h2>
            <div class="form-group">
                {{ form.house_type.label(class="form-label") }}
                {{ form.house_type(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.bedrooms.label(class="form-label") }}
                {{ form.bedrooms(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.occupants.label(class="form-label") }}
                {{ form.occupants(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.heating_type.label(class="form-label") }}
                {{ form.heating_type(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.green_tariff.label(class="form-label") }}
                {{ form.green_tariff(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.regular_turn_off.label(class="form-label") }}
                {{ form.regular_turn_off(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.winter_temp.label(class="form-label") }}
                {{ form.winter_temp(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.efficiency_improvements.label(class="form-label") }}
                {{ form.efficiency_improvements(class="form-control") }}
            </div>

            <h2>Stuff</h2>
            <div class="form-group">
                {{ form.new_household_items.label(class="form-label") }}
                {{ form.new_household_items(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.clothes_spend.label(class="form-label") }}
                {{ form.clothes_spend(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.pet_spend.label(class="form-label") }}
                {{ form.pet_spend(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.health_spend.label(class="form-label") }}
                {{ form.health_spend(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.contract_spend.label(class="form-label") }}
                {{ form.contract_spend(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.entertainment_spend.label(class="form-label") }}
                {{ form.entertainment_spend(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.recycling.label(class="form-label") }}
                {{ form.recycling(class="form-control") }}
            </div>

            <h2>Personal</h2>
            <div class="form-group">
                {{ form.location.label(class="form-label") }}
                {{ form.location(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.postcode.label(class="form-label") }}
                {{ form.postcode(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.age.label(class="form-label") }}
                {{ form.age(class="form-control") }}
            </div>

            <div class="form-actions">
                {{ form.submit_footprint(class="hero-cta-button") }}
            </div>
        </form>
        {% endif %}
    </div>
</div>
{% endblock %}